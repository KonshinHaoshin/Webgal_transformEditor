# WebGAL Transform Editor

🎥 基于 [Tauri](https://tauri.app) + [React](https://react.dev) + [TypeScript](https://www.typescriptlang.org/) 开发的 WebGAL 运镜脚本编辑器。  
支持可视化设置立绘位置、缩放、旋转（弧度），并导出 `setTransform` 与 `changeFigure` 指令！

---

## ✨ 功能特色

### 🎯 核心编辑功能
- ✅ 支持解析与编辑 `setTransform` 脚本（位置、缩放、旋转）
- ✅ 支持 `changeFigure` 指令编辑与导出（motion / expression / id / transform）
- ✅ 增量合并：`setTransform` 命令支持继承上一句的属性值
- ✅ 实时导出 WebGAL 脚本片段

### 🖱️ 交互操作
- ✅ **鼠标拖拽**：自由移动模型位置
- ✅ **缩放**：`Ctrl + 鼠标滚轮` 缩放模型
- ✅ **旋转**：`Alt + 鼠标拖拽` 旋转模型，体验类似 Photoshop 旋转控件
- ✅ **多选**：`Shift + 点击` 选中多个模型
- ✅ **全选/取消全选**：使用工具栏按钮快速选择所有模型

### 🎮 WebGAL 模式
- ✅ 连接 WebGAL 游戏文件夹，自动识别 `figure` 和 `background` 目录
- ✅ 可视化选择立绘和背景文件
- ✅ 一键加载游戏资源，无需手动复制文件路径

### 👁️ 观测层功能
- ✅ **颜色层**：在场景上覆盖一层中性灰，混合模式为颜色，用于观测明度。
- ✅ **明度层**：在场景上覆盖一层中性灰，混合模式为明度，用于观测颜色。
- ⚠️ **注意**：开启观测层时，画布会阻止交互，无法拖拽或旋转模型（用于纯粹查看效果）

### 📏 辅助线功能
- ✅ **无辅助线**：关闭辅助线显示
- ✅ **九宫格**：显示 3×3 网格辅助线
- ✅ **三分法**：显示三分法构图辅助线
- ✅ **中心十字**：显示中心十字辅助线
- ✅ **对角线**：显示对角线辅助线
- ✅ **黄金比例**：显示黄金比例辅助线

### 🎨 滤镜系统
- ✅ 丰富的内置滤镜预设（模糊、老电影、噪点、反射、RGB分离等）
- ✅ 自定义滤镜参数调整
- ✅ 支持保存和加载用户预设
- ✅ 可选择应用到所有模型或仅选中模型

---

## 🚀 快速开始

### 1. 克隆项目

```bash
git clone https://github.com/KonshinHaoshin/Webgal_transformEditor.git
cd Webgal_transformEditor
```

### 2. 安装依赖

本项目使用 npm 作为包管理器

```bash
npm install
```

### 3. 启动开发环境

```bash
npm run tauri dev
```

启动后自动打开桌面窗口，进行可视化脚本编辑。

---

## 📖 详细使用方法

### 🖱️ 基础操作

#### 移动模型
1. **单选移动**：直接点击并拖拽模型
2. **多选移动**：
   - 按住 `Shift` 键，依次点击需要选中的模型
   - 或者点击 "Select All" 按钮全选所有模型
   - 选中后拖拽任意一个模型，所有选中的模型会同步移动

#### 缩放模型
- 按住 `Ctrl` 键，然后滚动鼠标滚轮
- **向上滚动**：放大模型
- **向下滚动**：缩小模型
- 缩放会相对于鼠标位置进行，提供更精确的缩放体验

#### 旋转模型
- 按住 `Alt` 键，然后拖拽模型
- 旋转会围绕模型中心点进行
- 旋转角度以弧度为单位显示（后续会转换为度数的显示）

#### 选择操作
- **单选**：直接点击模型
- **多选**：按住 `Shift` 键，点击多个模型
- **全选**：点击工具栏的 "Select All" 按钮
- **取消全选**：点击工具栏的 "Deselect All" 按钮

### 🎮 WebGAL 模式使用

1. **启用 WebGAL 模式**：
   - 勾选界面上的 "WebGAL模式" 复选框
   - 在弹出的文件夹选择对话框中选择你的 WebGAL 游戏根目录

2. **退出 WebGAL 模式**：
   - 取消勾选 "WebGAL模式" 复选框即可退出

### 👁️ 观测层功能使用

1. **开启观测层**：
   - 在顶部工具栏找到 "观察层" 下拉菜单
   - 选择 "颜色" 或 "明度" 模式

2. **查看效果**：
   - 场景会实时转换为对应的观测模式显示
   - 便于检查构图的色彩分布或明度层次

3. **注意事项**：
   - ⚠️ **开启观测层时，画布会阻止所有交互**（包括拖拽、旋转、缩放）
   - 这是设计特性，目的是让你专注于查看效果而不误操作

4. **关闭观测层**：
   - 在 "观察层" 下拉菜单中选择 "无" 即可恢复正常显示和交互

### 📏 辅助线功能使用

1. **选择辅助线类型**：
   - 在顶部工具栏找到 "辅助线" 下拉菜单
   - 选择需要的辅助线类型：
     - **无辅助线**：关闭辅助线
     - **三分法**：显示三分法构图线，适合突出主体
     - **中心十字**：显示中心十字线，适合对称构图
     - **对角线**：显示对角线，适合动态构图
     - **黄金比例**：显示黄金比例线，适合经典构图

2. **使用技巧**：
   - 辅助线会叠加显示在画布上，不会影响实际操作
   - 可以随时切换不同的辅助线类型来比较效果
   - 建议在最终确定位置前使用辅助线检查构图

### 🎨 滤镜功能使用

1. **应用滤镜预设**：
   - 勾选 "启用滤镜预设" 复选框
   - 在滤镜预设下拉菜单中选择预设
   - 点击 "应用到选中模型" 或 "应用到所有模型"

2. **自定义滤镜**：
   - 调整右侧滤镜面板中的各项参数
   - 参数会实时应用到画布上

3. **保存自定义预设**：
   - 调整好滤镜参数后，可以在滤镜面板中保存为自定义预设
   - 自定义预设会保存到浏览器本地存储中

4. **应用范围**：
   - **应用到选中模型**：仅将滤镜应用到当前选中的模型
   - **应用到所有模型**：将滤镜应用到画布上的所有模型（包括背景）

### 📝 脚本编辑

1. **解析脚本**：
   - 在左侧文本框中粘贴 WebGAL 脚本
   - 点击 "解析脚本" 按钮，脚本会被解析并在画布上显示

2. **导出脚本**：
   - 编辑完成后，点击 "导出脚本" 按钮
   - 脚本会显示在文本框中，可以直接复制使用

3. **增量编辑**：
   - 支持 `setTransform` 命令的增量编辑
   - 如果只修改 `position.x`，`position.y` 会自动继承上一句的值
   - 这让你可以更方便地编写连续的运镜脚本


---

## 📄 许可证

查看 [LICENSE](LICENSE) 文件了解详情。

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

**Happy Editing! 🎉**
